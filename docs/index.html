<!doctype html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>3D Pinball for Windows - Space Cadet</title>
  <style>
    body {
      font-family:Tahoma,Geneva,Verdana,sans-serif;
      background-color:rgb(58, 110, 165);
      text-align:center;
    }
    canvas.emscripten {
      border:0 none;
      background-color:#000
    }
    #status { margin:40px 32px }
  </style>
</head>
<body>
  <div class="window">
    <h2>3D Pinball for Windows - Space Cadet</h2>
    <div id="status">Downloading...</div>
    <progress hidden id="progress" max="100" value="0"></progress>
    <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()" style="display:none" tabindex="-1"></canvas>
  </div>

  <script>
    var statusElement = document.getElementById("status"),
        progressElement = document.getElementById("progress"),
        Module = {
          preRun: [],
          postRun: [],
          print: text => console.log(text),
          printErr: text => console.error(text),
          canvas: (function() {
            var e = document.getElementById("canvas");
            e.addEventListener("webglcontextlost", function(ev) {
              alert("WebGL context lost. You will need to reload the page.");
              ev.preventDefault();
            }, false);
            return e;
          })(),
          setStatus: function(text) {
            if (!Module.setStatus.last) Module.setStatus.last = {time: Date.now(), text: ""};
            if (text !== Module.setStatus.last.text) {
              Module.setStatus.last.time = Date.now();
              Module.setStatus.last.text = text;
              statusElement.innerHTML = text;
              if (text === "" || text === "All downloads complete.") {
                statusElement.style.display = "none";
                progressElement.style.display = "none";
              }
            }
          },
          locateFile: function(path) {
            if (path.endsWith(".wasm")) return "./SpaceCadetPinball.wasm";
            if (path.endsWith(".data")) return "./SpaceCadetPinball.data";
            return path;
          }
        };
    Module.setStatus("Downloading...");
    window.onerror = function() {
      Module.setStatus("Exception thrown, see JavaScript console");
    };

    // âœ… WebAssembly fallback
    if (WebAssembly.instantiateStreaming) {
      var oldInstantiateStreaming = WebAssembly.instantiateStreaming;
      WebAssembly.instantiateStreaming = function(response, importObject) {
        return Promise.resolve(response).then(function(resp) {
          return oldInstantiateStreaming(resp, importObject).catch(function(err) {
            console.warn("Streaming failed, falling back to ArrayBuffer:", err);
            return resp.arrayBuffer().then(function(bytes) {
              return WebAssembly.instantiate(bytes, importObject);
            });
          });
        });
      };
    }
  </script>

  <script async src="./SpaceCadetPinball.js"></script>
</body>
</html>
